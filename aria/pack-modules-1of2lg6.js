/*
 * Copyright 2009-2015 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//***MULTI-PART
//*******************
//LOGICAL-PATH:aria/core/IOFilter.js
//*******************
var e=require("../Aria"),t=require("../utils/Json"),i=require("./DownloadMgr");module.exports=e.classDefinition({$classpath:"aria.core.IOFilter",$constructor:function(e){this.requestDelay=e?e.requestDelay:null,this.responseDelay=e?e.responseDelay:null},$statics:{FILTER_REQ_ERROR:"An error occured in an IO filter:\ncall stack: onRequest\nclass: %1",FILTER_RES_ERROR:"An error occured in an IO filter:\ncall stack: onResponse\nclass: %1"},$prototype:{onRequest:function(e){null!=this.requestDelay&&(e.delay+=this.requestDelay)},onResponse:function(e){null!=this.responseDelay&&(e.delay+=this.responseDelay)},setJsonPostData:function(e,i){var r=e.sender;e.data=r&&"aria.modules.RequestMgr"==r.classpath?r.requestObject.requestHandler.prepareRequestBody(i,r.requestObject):t.convertToJsonString(i)},redirectToFile:function(e,t,r){t&&(e.url=i.resolveURL(t,!0),r!==!0&&(e.url=i.getURLWithTimestamp(e.url,!0)),e.method="GET",e.jsonp=null)},__onRequest:function(e){try{this.onRequest(e)}catch(t){this.$logError(this.FILTER_REQ_ERROR,[this.$classpath],t)}},__onResponse:function(e){try{this.onResponse(e)}catch(t){this.$logError(this.FILTER_RES_ERROR,[this.$classpath],t)}}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/environment/RequestHandlerCfgBeans.js
//*******************
var e=require("../../../Aria"),t=require("../../../core/JsonTypes");module.exports=e.beanDefinitions({$package:"aria.modules.requestHandler.environment.RequestHandlerCfgBeans",$namespaces:{json:t},$beans:{AppCfg:{$type:"json:Object",$restricted:!1,$properties:{requestHandler:{$type:"RequestHandlerCfg",$default:{implementation:"aria.modules.requestHandler.JSONRequestHandler"}},requestJsonSerializer:{$type:"RequestJsonSerializerCfg",$default:{options:{encodeParameters:!0,keepMetadata:!1}}}}},RequestHandlerCfg:{$type:"json:Object",$properties:{implementation:{$type:"json:PackageName",$default:null},args:{$type:"json:ObjectRef"}}},RequestJsonSerializerCfg:{$type:"json:Object",$properties:{instance:{$type:"json:ObjectRef"},options:{$type:"json:Map",$contentType:{$type:"json:MultiTypes"},$default:null}}}}});
//*******************
//LOGICAL-PATH:aria/modules/RequestBeans.js
//*******************
var e=require("../Aria"),t=require("../core/JsonTypes"),i=require("./requestHandler/environment/RequestHandlerCfgBeans");module.exports=e.beanDefinitions({$package:"aria.modules.RequestBeans",$namespaces:{json:t,env:i},$beans:{RequestObject:{$type:"SubmitJsonRequestOptions",$restricted:!1,$properties:{moduleName:{$type:"json:String",$mandatory:!0},actionName:{$type:"json:String",$mandatory:!1},serviceSpec:{$type:"json:ObjectRef",$mandatory:!1},session:{$type:"json:ObjectRef"},actionQueuing:{$type:"json:ObjectRef"},requestHandler:{$type:"json:ObjectRef"},urlService:{$type:"json:ObjectRef"},requestJsonSerializer:{$type:"env:RequestJsonSerializerCfg"}}},SubmitJsonRequestOptions:{$type:"json:Object",$properties:{async:{$type:"json:Boolean",$default:!0},timeout:{$type:"json:Integer"},headers:{$type:"json:Map",$contentType:{$type:"json:String"},$sample:{"Content-Type":"text/plain",Connection:"keep-alive"}}}},RequestDetails:{$type:"json:Object",$restricted:!1,$properties:{url:{$type:"json:String",$mandatory:!0},method:{$type:"json:String"}}},SuccessResponse:{$type:"json:Object",$properties:{responseText:{$type:"json:String"},responseXML:{$type:"json:ObjectRef"},responseJSON:{$type:"json:ObjectRef"}}},FailureResponse:{$type:"json:Object",$properties:{status:{$type:"json:Integer",$mandatory:!0},error:{$type:"json:String"},responseText:{$type:"json:String"},responseXML:{$type:"json:ObjectRef"},responseJSON:{$type:"json:ObjectRef"}}},Request:{$type:"json:Object",$properties:{url:{$type:"json:String"},session:{$type:"json:ObjectRef"},requestObject:{$type:"RequestObject"}}},ProcessedResponse:{$type:"json:Object",$restricted:!1,$properties:{response:{$type:"json:ObjectRef"},error:{$type:"json:Boolean"},errorData:{$type:"json:ObjectRef"}}}}});
//*******************
//LOGICAL-PATH:aria/modules/queuing/SimpleSessionQueuing.js
//*******************
var e=require("../../Aria");module.exports=e.classDefinition({$classpath:"aria.modules.queuing.SimpleSessionQueuing",$constructor:function(){this._idSessionMap={},this._sessionQueues={}},$statics:{NO_SESSION_ID_KEY:"1"},$destructor:function(){this._idSessionMap=null;for(var e in this._sessionQueues)this._sessionQueues.hasOwnProperty(e)&&delete this._sessionQueues[e];this._sessionQueues=null},$prototype:{pushRequest:function(e,t,i){var r,a=e.session.id;if(a||(a=this.NO_SESSION_ID_KEY),this._sessionQueues[a]||(this._sessionQueues[a]=[]),r=this._sessionQueues[a],e.actionQueuing=this,r.length>0)return r.push({requestObject:e,jsonData:t,cb:i}),aria.modules.RequestMgr.QUEUE_STATUS;var n=this._sendRequest(e,t,i);return n===aria.modules.RequestMgr.ERROR_STATUS?n:e.async!==!1?(this._idSessionMap[n]=a,r.push(n),aria.modules.RequestMgr.EXECUTE_STATUS):void 0},handleNextRequest:function(e){if(this._idSessionMap){var t,i,r=this._idSessionMap[e];if(r){delete this._idSessionMap[e];var a=this._sessionQueues[r];for(this.$assert(99,a&&a.length>0),this.$assert(100,a[0]===e),a.splice(0,1);a.length>0;){if(t=a[0],i=this._sendRequest(t.requestObject,t.jsonData,t.cb),i!==aria.modules.RequestMgr.ERROR_STATUS)return this._idSessionMap[i]=r,void(a[0]=i);a.splice(0,1)}}}},_sendRequest:function(e,t,i){return aria.modules.RequestMgr.sendJsonRequest(e,t,i)}}});
//*******************
//LOGICAL-PATH:aria/modules/urlService/environment/UrlServiceCfgBeans.js
//*******************
var e=require("../../../Aria"),t=require("../../../core/JsonTypes");module.exports=e.beanDefinitions({$package:"aria.modules.urlService.environment.UrlServiceCfgBeans",$namespaces:{json:t},$beans:{AppCfg:{$type:"json:Object",$restricted:!1,$properties:{urlService:{$type:"UrlServiceCfg",$default:{implementation:"aria.modules.urlService.PatternURLCreationImpl",args:["${moduleName}/${actionName}","${moduleName}"]}}}},UrlServiceCfg:{$type:"json:Object",$properties:{implementation:{$type:"json:PackageName",$default:null},args:{$type:"json:Array",$default:[],$contentType:{$type:"json:String"}}}}}});
//*******************
//LOGICAL-PATH:aria/modules/urlService/environment/UrlService.js
//*******************
var e=require("../../../Aria");require("./UrlServiceCfgBeans");var t=require("../../../core/environment/EnvironmentBase"),i=require("../../../utils/Json");module.exports=e.classDefinition({$classpath:"aria.modules.urlService.environment.UrlService",$extends:t,$singleton:!0,$prototype:{_cfgPackage:"aria.modules.urlService.environment.UrlServiceCfgBeans.AppCfg",getUrlServiceCfg:function(){return i.copy(this.checkApplicationSettings("urlService"))}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/environment/RequestHandler.js
//*******************
var e=require("../../../Aria");require("./RequestHandlerCfgBeans");var t=require("../../../core/environment/EnvironmentBase"),i=require("../../../utils/Json");module.exports=e.classDefinition({$classpath:"aria.modules.requestHandler.environment.RequestHandler",$singleton:!0,$extends:t,$prototype:{_cfgPackage:"aria.modules.requestHandler.environment.RequestHandlerCfgBeans.AppCfg",getRequestHandlerCfg:function(){return i.copy(this.checkApplicationSettings("requestHandler"))},getRequestJsonSerializerCfg:function(){return this.checkApplicationSettings("requestJsonSerializer")}}});
//*******************
//LOGICAL-PATH:aria/modules/RequestMgr.js
//*******************
var e=require("../Aria"),t=require("./queuing/SimpleSessionQueuing");require("./RequestBeans");var i=require("./urlService/environment/UrlService"),r=require("./requestHandler/environment/RequestHandler"),a=require("../utils/Type"),n=require("../core/IO"),s=require("../core/JsonValidator"),o=require("../core/AppEnvironment"),l=require("../utils/Json");module.exports=e.classDefinition({$classpath:"aria.modules.RequestMgr",$singleton:!0,$events:{error:""},$constructor:function(){this.session={paramName:"jsessionid",id:""},this._params=null,this.defaultActionQueuing=new t,this._idCounter=1,this._urlService=null,this._requestHandler=null,o.$on({changingEnvironment:{fn:this.__environmentUpdated,scope:this},environmentChanged:{fn:this.__environmentUpdated,scope:this}})},$destructor:function(){this._params=null,this._urlService&&(this._urlService.$dispose(),this._urlService=null),this._requestHandler&&(this._requestHandler.$dispose(),this._requestHandler=null),this.defaultActionQueuing&&(this.defaultActionQueuing.$dispose(),this.defaultActionQueuing=null)},$statics:{ERROR_STATUS:-1,EXECUTE_STATUS:0,QUEUE_STATUS:1,DISCARD_STATUS:2,INVALID_REQUEST_OBJECT:"Provided request object does not match aria.modules.RequestBeans.RequestObject.",FILTER_CREATION_ERROR:"An error occured while creating a Request filter:\nclass: %1",INVALID_BASEURL:"The base URL defined in the RequestMgr object is empty or invalid - please check: \nurl: %1",MISSING_SERVICESPEC:"Provided request object must contain an actionName or a serviceSpec element",CALLBACK_ERROR:"An error occured in the Request manager while processing the callback function.",INVALID_URL:"Url for request is invalid: %1",DEPENDENCIES_BROKE_SYNC:"Dependencies asynchronous load broke a synchronous request: all the dependencies have to be loaded before: %1"},$prototype:{addParam:function(e,t){if(null==t)return this.removeParam(e);null==this._params&&(this._params=[]);for(var i=0,r=this._params.length;r>i;i++){var a=this._params[i];if(a.name===e)return void(a.value=encodeURIComponent(t))}this._params.push({name:e,value:encodeURIComponent(t)})},getParam:function(e){if(null==e||null==this._params)return null;for(var t=0,i=this._params.length;i>t;t++){var r=this._params[t];if(r.name===e)return r.value}return null},removeParam:function(e){if(null==e&&(this._params=null),null!=this._params)for(var t=0,i=this._params.length;i>t;t++){var r=this._params[t];r.name===e&&(this._params.splice(t,1),i--)}},submitJsonRequest:function(e,t,i){try{s.normalize({json:e,beanName:"aria.modules.RequestBeans.RequestObject"},!0)}catch(r){return this.$logError(this.INVALID_REQUEST_OBJECT,null,e),this.DISCARD_STATUS}return e.actionQueuing||(e.actionQueuing=this.defaultActionQueuing),e.session||(e.session=this.session),e.requestHandler||(e.requestHandler=this._requestHandler),e.actionQueuing.pushRequest(e,t,i)},__getHandlersDependencies:function(e){var t=[],a=i;if(!e.urlService&&!this._urlService){var n=a.getUrlServiceCfg();t.push(n.implementation)}if(!e.requestHandler&&!this._requestHandler){var s=r.getRequestHandlerCfg();t.push(s.implementation)}return t},sendJsonRequest:function(t,i,r){var a={requestObject:t,jsonData:i,data:null,timeout:t.timeout,method:"POST"},n=this._idCounter++,s=this.__getHandlersDependencies(t),o={req:a,cb:r,id:n,session:t.session,actionQueuing:t.actionQueuing,requestHandler:t.requestHandler,syncFlag:!1};return e.load({classes:s,oncomplete:{fn:this._onDependenciesReady,scope:this,args:o}}),o.syncFlag||t.async!==!1||this.$logError(this.DEPENDENCIES_BROKE_SYNC,[s]),n},_onDependenciesReady:function(e){e.syncFlag=!0;var t=e.req,i=this.createRequestDetails(t.requestObject,e.session);return i&&""!==i.url?(t.url=i.url,i.method&&(t.method=i.method),void this._callAsyncRequest(e)):this.$logError(this.INVALID_URL,[""])},_callAsyncRequest:function(e){var t=e.req,i=e.requestHandler;null==i&&(i=this.__getRequestHandler()),t.data=null==t.data&&"POST"==t.method?i.prepareRequestBody(t.jsonData,t.requestObject):t.data,t.headers=i.getRequestHeaders(),t.requestObject.headers&&(t.headers=l.copy(t.headers,!1),l.inject(t.requestObject.headers,t.headers,!1));var r={classpath:this.$classpath,requestObject:t.requestObject,requestData:t.jsonData,responseData:null,responseErrorData:null},a={sender:r,url:t.url,async:t.requestObject.async!==!1,method:t.method,data:t.data,headers:t.headers,timeout:t.timeout,callback:{fn:this._onresponse,onerror:this._onresponse,scope:this,args:{requestObject:t.requestObject,senderObject:r,cb:e.cb,id:e.id,session:e.session,actionQueuing:e.actionQueuing,requestHandler:i}}};i.expectedResponseType&&(a.expectedResponseType=i.expectedResponseType),n.asyncRequest(a)},_onresponse:function(e,t){var i=t.requestObject,r=t.actionQueuing,a=t.id,n=t.senderObject;r&&r.handleNextRequest(a);var s={requestUrl:e.url,requestObject:i,responseXML:e.responseXML,responseText:e.responseText,responseJSON:e.responseJSON,status:e.status,error:e.error,data:n.responseData,errorData:n.responseErrorData};t.res=s,this._processOnResponse(t)},_processOnResponse:function(e){var t=e.res,i=e.requestHandler;t.error?i.processFailure({error:t.error,status:t.status,responseXML:t.responseXML,responseText:t.responseText,responseJSON:t.responseJSON},{url:e.res.url,session:e.session,requestObject:e.requestObject},{fn:this._callRequestCallback,scope:this,args:e}):i.processSuccess({responseXML:t.responseXML,responseText:t.responseText,responseJSON:t.responseJSON},{url:t.url,session:e.session,requestObject:e.requestObject},{fn:this._callRequestCallback,scope:this,args:e})},_callRequestCallback:function(e,t){var i=t.res;if(i.errorData&&(e.error=!0),i.data&&(e.data=i.data),i.errorData&&(e.errorData=i.errorData),e.error){var r={name:"error",requestUrl:i.requestUrl,requestObject:t.requestObject,errorData:e.errorData};i.error&&(r.httpError={error:i.error,status:i.status}),this.$raiseEvent(r)}this.$callback(t.cb,e,this.CALLBACK_ERROR)},createRequestDetails:function(e,t){var i=a,r=e.urlService;r||(r=this.__getUrlService()),this.$assert(434,null!=r),t||(t=this.session);var n,s=e.moduleName.replace(/\./g,"/");if(i.isString(e.actionName)){var o=this.__extractActionName(e.actionName);n=r.createActionUrl(s,o.name,t.id)}else{if(!e.serviceSpec)return this.$logError(this.MISSING_SERVICESPEC,[n]),null;n=r.createServiceUrl(s,e.serviceSpec,t.id)}return!n||i.isObject(n)&&!n.url?(this.$logError(this.INVALID_BASEURL,[n]),null):(i.isString(n)&&(n={url:n}),n.method||(n.method="POST"),e.actionName&&(n.url=this.__appendActionParameters(n.url,o.params)),n.url=this.__appendGlobalParams(n.url,this._params),n)},createI18nUrl:function(t,r,a){var n=i.getUrlServiceCfg();e.load({classes:[n.implementation],oncomplete:{fn:this.__onI18nReady,scope:this,args:{moduleName:t,locale:r,callback:a}}})},__onI18nReady:function(e){var t=this.__getUrlService();this.$assert(595,null!=t);var i=t.createI18nUrl(e.moduleName,this.session.id,e.locale);i=this.__appendGlobalParams(i,this._params),e.callback.args=e.callback.args||{},e.callback.args.full=i,this.$callback(e.callback,i)},__appendGlobalParams:function(e,t){if(!t||0===t.length)return e;for(var i=[],r=0,a=t.length;a>r;r+=1){var n=t[r];i.push(n.name+"="+n.value)}var s="&",o=i.join(s);return this.__appendActionParameters(e,o)},__appendActionParameters:function(e,t){if(e=e||"",!t)return e;var i=e.indexOf("?"),r="&";return e+=i>-1?r:"?",e+t},__extractActionName:function(e){e=e||"";var t=e.indexOf("?"),i={name:"",params:""};return 0>t?i.name=e:i={name:e.substring(0,t),params:e.substring(t+1)},i},__getUrlService:function(){if(!this._urlService){var t=i.getUrlServiceCfg(),r=t.args[0],a=t.args[1],n=e.getClassRef(t.implementation);this._urlService=new n(r,a)}return this._urlService},__getRequestHandler:function(){if(!this._requestHandler){var t=r.getRequestHandlerCfg();this._requestHandler=e.getClassInstance(t.implementation,t.args)}return this._requestHandler},__environmentUpdated:function(e){return"environmentChanged"==e.name?(this._urlService&&(this._urlService.$dispose(),this._urlService=null),void(this._requestHandler&&(this._requestHandler.$dispose(),this._requestHandler=null))):void 0}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/IRequestHandler.js
//*******************
var e=require("../../Aria");module.exports=e.interfaceDefinition({$classpath:"aria.modules.requestHandler.IRequestHandler",$interface:{processSuccess:function(){},processFailure:function(){},prepareRequestBody:function(){},serializeRequestData:function(){},expectedResponseType:{$type:"Object"},getRequestHeaders:function(){}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/RequestHandler.js
//*******************
var e=require("../../Aria"),t=require("./IRequestHandler"),i=require("./environment/RequestHandler"),r=require("../../utils/Json"),n=require("../../core/AppEnvironment");module.exports=e.classDefinition({$classpath:"aria.modules.requestHandler.RequestHandler",$implements:[t],$statics:{HTTP_ERRORS_GENERAL:"An uncatalogued HTTP error was generated",HTTP_ERRORS_400:"400 Bad Request: The request cannot be fulfilled due to bad syntax.",HTTP_ERRORS_401:"401 Unauthorized: Similar to 403 Forbidden, but specifically for use when authentication is possible but has failed or not yet been provided.",HTTP_ERRORS_403:"403 Forbidden: The request was a legal request, but the server is refusing to respond to it.",HTTP_ERRORS_404:"404 Not Found: The requested resource could not be found but may be available again in the future.  Subsequent requests by the client are permissible.",HTTP_ERRORS_500:"500 Internal Server Error: A generic error message, given when no more specific message is suitable."},$constructor:function(){this._requestJsonSerializer=i.getRequestJsonSerializerCfg(),n.$on({changingEnvironment:{fn:this.__environmentUpdated,scope:this},environmentChanged:{fn:this.__environmentUpdated,scope:this}}),this.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},$destructor:function(){this._requestJsonSerializer=null},$prototype:{processSuccess:function(e,t,i){this.$callback(i,e)},processFailure:function(e,t,i){var r=e.status,n={response:{responseText:e.responseText,responseJSON:e.responseJSON,responseXML:e.responseXML},error:!0},a="HTTP_ERRORS_"+r,s=this[a];s||(s=this.HTTP_ERRORS_GENERAL),n.errorData={messageBean:{code:r,localizedMessage:s,type:"HTTPERROR"}},this.$callback(i,n)},prepareRequestBody:function(e,t){return this.serializeRequestData(e,t)},serializeRequestData:function(e,t){var i=t?t.requestJsonSerializer:null,n=i?i.options:null,a=i?i.instance:null;return a?r.convertToJsonString(e,r.copy(n,!0),a):(n=n||this._requestJsonSerializer.options,a=this._requestJsonSerializer.instance,r.convertToJsonString(e,r.copy(n,!0),a))},getRequestHeaders:function(){return this.headers},__environmentUpdated:function(){this._requestJsonSerializer=i.getRequestJsonSerializerCfg()}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/JSONRequestHandler.js
//*******************
var e=require("../../Aria"),t=require("./IRequestHandler"),i=require("./RequestHandler"),r=require("../../utils/Json");module.exports=e.classDefinition({$classpath:"aria.modules.requestHandler.JSONRequestHandler",$extends:i,$implements:[t],$statics:{PARSING_ERROR:"Response text could not be evaluated as JSON."},$constructor:function(){this.$RequestHandler.constructor.call(this),this.headers={"Content-Type":"application/json"}},$prototype:{expectedResponseType:"json",processSuccess:function(e,t,i){var a={};e.responseJSON?a.response=e.responseJSON:e.responseText?(a.response=r.load(e.responseText,this,this.PARSING_ERROR),a.response||(a.error=!0),a.error&&(a.errorData={messageBean:{localizedMessage:this.PARSING_ERROR,type:"PARSINGERROR"}})):a.response=null,this.$callback(i,a)}}});
//*******************
//LOGICAL-PATH:aria/modules/requestHandler/XMLRequestHandler.js
//*******************
var e=require("../../Aria"),t=require("./IRequestHandler"),i=require("./RequestHandler");module.exports=e.classDefinition({$classpath:"aria.modules.requestHandler.XMLRequestHandler",$extends:i,$implements:[t],$statics:{MIMETYPE_ERROR:"Response type is badly configured, it should have returned a xml response."},$prototype:{processSuccess:function(e,t,i){var r;r=!e.responseXML||e.responseXML&&!e.responseXML.documentElement?{response:null,error:!0,errorData:{messageBean:{localizedMessage:this.MIMETYPE_ERROR,type:"TYPEERROR"}}}:this.processXMLDocument(e.responseXML.documentElement,t),this.$callback(i,r)},processXMLDocument:function(e){return{response:e}}}});
//*******************
//LOGICAL-PATH:aria/modules/urlService/IUrlService.js
//*******************
var e=require("../../Aria");module.exports=e.interfaceDefinition({$classpath:"aria.modules.urlService.IUrlService",$interface:{createActionUrl:function(){},createServiceUrl:function(){},createI18nUrl:function(){}}});
//*******************
//LOGICAL-PATH:aria/modules/urlService/PatternURLCreationImpl.js
//*******************
var e=require("../../Aria"),t=require("./IUrlService");module.exports=e.classDefinition({$classpath:"aria.modules.urlService.PatternURLCreationImpl",$implements:[t],$constructor:function(e,t){this.actionUrlPattern=e||"",this.i18nUrlPattern=t||""},$destructor:function(){},$prototype:{createActionUrl:function(e,t,i){var r=this.actionUrlPattern;return r=r.replace(/\$\{moduleName\}/g,e||""),r=r.replace(/\$\{actionName\}/g,t||""),r=r.replace(/\$\{sessionId\}/g,i||"")},createServiceUrl:function(e,t,i){return t&&t.actionName?this.createActionUrl(e,t.actionName,i):this.createActionUrl(e,null,i)},createI18nUrl:function(e,t,i){var r=this.i18nUrlPattern;return r=r.replace(/\$\{moduleName\}/g,e||""),r=r.replace(/\$\{sessionId\}/g,t||""),r=r.replace(/\$\{locale\}/g,i||"")}}});