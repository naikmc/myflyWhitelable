/*
 * Copyright 2009-2015 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//***MULTI-PART
//*******************
//LOGICAL-PATH:aria/utils/dragdrop/IDrag.js
//*******************
var e=require("../../Aria");module.exports=e.interfaceDefinition({$classpath:"aria.utils.dragdrop.IDrag",$interface:{start:{$type:"Function"},move:{$type:"Function"},end:{$type:"Function"}},$events:{dragstart:"",move:"",dragend:"",beforeresize:"",resize:"",resizeend:""}});
//*******************
//LOGICAL-PATH:aria/utils/dragdrop/Drag.js
//*******************
var e=require("../../Aria"),t=require("../Dom"),i=require("../Mouse"),r=require("../Type"),a=require("./IDrag"),s=require("../Json");!function(){function n(e,t,i){e&&e.setAttribute(t,i)}function o(e,t){e&&e.removeAttribute(t)}var l=0;module.exports=e.classDefinition({$classpath:"aria.utils.dragdrop.Drag",$implements:[a],$statics:{INVALID_ATTRIBUTE:"Invalid attribute '%1' in '%2'"},$constructor:function(t,a){a=a||{},this.id=null,this.element=null;var s=r;s.isString(t)?this.id=t:s.isHTMLElement(t)?(this.element=t,this.id=this.element.id):(this.$logError(this.INVALID_ATTRIBUTE,["id","constructor"]),this.start=e.empty,this.move=e.empty,this.end=e.empty),this.params=a,this.handle=a.handle,this.cursor=a.cursor,this.originalCursor=null,this.proxy=null,this.posX=null,this.posY=null,this._boundary=null,this._horizontal=a.axis&&"x"==a.axis,this._vertical=a.axis&&"y"==a.axis,this._elementInitialPosition=null,this._mouseInitialPosition=null,this._movableInitialGeometry=null,this._movableGeometry=null,this._baseMovableOffset=null,this.listenerId=i.listen("drag",this),n(this.getDraggable(!0),i.DRAGGABLE_ATTRIBUTE,this.listenerId),this.getMovable(!1)},$destructor:function(){var e=this.getDraggable();e&&(o(e,i.DRAGGABLE_ATTRIBUTE),e.style.cursor=this.originalCursor,e=null),this.proxy&&this.proxy.overlay&&this.proxy.$dispose(),this.element=null,this.handle=null,this.cursor=null,this.proxy=null,i.stopListen("drag",this)},$prototype:{getDraggable:function(e){var i,a=this.handle,s=this.cursor;if(a){var n=r;n.isString(a)&&(a=t.getElementById(a)),n.isHTMLElement(a)?(this.handle=a,i=a):e===!0&&this.$logError(this.INVALID_ATTRIBUTE,["handle","params"])}else i=this.getElement(e);return i?(s&&(null==this.originalCursor&&(this.originalCursor=i.style.cursor),i.style.cursor=s),i):void 0},getElement:function(e){var i=this.element;if(!i){if(i=t.getElementById(this.id),!i)return void(e===!0&&this.$logError(this.INVALID_ATTRIBUTE,["id","constructor"]));this.element=i}return i},_setElementStyle:function(e){var i=t.getOffset(e);this._elementInitialPosition=i;var r=e.style;r.position="absolute",r.left=i.left+"px",r.top=i.top+"px"},getMovable:function(t){var i=this.proxy;if(i)return i.overlay;var r=this.params,a=r.proxy;if(a){var s="aria.utils.overlay."+a.type;return e.load({classes:[s],oncomplete:t===!1?null:{fn:this._createProxy,scope:this,args:{classpath:s,cfg:a.cfg}},onerror:{fn:function(){this.$logError(this.INVALID_ATTRIBUTE,["proxy","params"])},scope:this,override:!0}}),t===!1||this.proxy||(this.proxy={}),this.proxy?this.proxy.overlay:this.proxy}return this.getElement()},_createProxy:function(t){var i=e.getClassRef(t.classpath);try{var r=t.cfg||{};r.id=this.id||"proxy_"+l,l++,this.proxy=new i(this.getElement(),r)}catch(a){this.$logError(this.INVALID_ATTRIBUTE,["proxy","params"])}},start:function(i){this.posX=i.x,this.posY=i.y,this._mouseInitialPosition={left:i.x,top:i.y};var r=this.getElement(!0),a=t;r.onselectstart=e.returnFalse,this._setElementStyle(r),this._setBoundary();var n=this.getMovable();if(n){n.onselectstart=e.returnFalse,this._movableInitialGeometry=a.getGeometry(n),this._movableGeometry=s.copy(this._movableInitialGeometry);var o=a.getOffset(n);this._baseMovableOffset={left:this._movableGeometry.x-o.left,top:this._movableGeometry.y-o.top},this.$raiseEvent("dragstart")}},move:function(e){var i=this.getMovable(),r=t;if(i&&i.style){var a=s.copy(this._movableGeometry),n=this._mouseInitialPosition,o=this._movableInitialGeometry;this._vertical||(a.x=o.x+e.clientX-n.left),this._horizontal||(a.y=o.y+e.clientY-n.top);var l=this._boundary?r.fitInside(a,this._boundary):{top:a.y,left:a.x};i.style.top=l.top-this._baseMovableOffset.top+"px",i.style.left=l.left-this._baseMovableOffset.left+"px",a.y=l.top,a.x=l.left,this.posY=n.top+a.y-o.y,this.posX=n.left+a.x-o.x,this._movableGeometry=a,this.$raiseEvent("move")}},end:function(){var t=this.getElement();t.onselectstart=e.returnTrue,this.proxy&&this.proxy.overlay&&(t.style.top=this._elementInitialPosition.top+this._movableGeometry.y-this._movableInitialGeometry.y+"px",t.style.left=this._elementInitialPosition.left+this._movableGeometry.x-this._movableInitialGeometry.x+"px",this.proxy.$dispose(),this.proxy=null),this.$raiseEvent("dragend")},_setBoundary:function(){var e=this.params.constrainTo,i=t;return e&&e!==i.VIEWPORT?(r.isString(e)&&(e=i.getElementById(e)),e?void(this._boundary=t.getGeometry(e)):(this._boundary=null,void this.$logError(this.INVALID_ATTRIBUTE,["constrainTo","params"]))):void(this._boundary=e)}}})}();
//*******************
//LOGICAL-PATH:aria/utils/dragdrop/DragDropBean.js
//*******************
var e=require("../../Aria"),t=require("../../core/JsonTypes");module.exports=e.beanDefinitions({$package:"aria.utils.dragdrop.DragDropBean",$namespaces:{json:t},$beans:{DragCfg:{$type:"json:Object",$properties:{handle:{$type:"json:MultiTypes",$contentTypes:[{$type:"json:String"},{$type:"json:ObjectRef"}]},cursor:{$type:"json:String"},proxy:{$type:"ProxyCfg"},constrainTo:{$type:"json:MultiTypes",$contentTypes:[{$type:"json:String"},{$type:"json:String"},{$type:"json:ObjectRef"}]},axis:{$type:"json:Enum",$enumValues:["x","y"]}}},ProxyCfg:{$type:"json:Object",$properties:{type:{$type:"json:Enum",$enumValues:["Overlay","CloneOverlay"]},cfg:{$type:"json:ObjectRef"}}}}});
//*******************
//LOGICAL-PATH:aria/utils/resize/Resize.js
//*******************
var e=require("../../Aria"),t=require("../Dom"),i=require("../String"),r=require("../Json"),a=require("../dragdrop/Drag");module.exports=e.classDefinition({$classpath:"aria.utils.resize.Resize",$extends:a,$constructor:function(e,i){i=i||{};var r={type:"Overlay"},a=e,s=this;this.minHeight=100,this.minWidth=100,this.$Drag.constructor.call(s,a,{handle:i.handle,cursor:i.cursor,proxy:r,axis:i.axis,constrainTo:t.VIEWPORT})},$destructor:function(){this.$Drag.$destructor.call(this),this.minHeight=null,this.minWidth=null},$prototype:{start:function(i){this.posX=i.x,this.posY=i.y;var a,s=this.getElement(!0),n=e.$window.document;s.onselectstart=e.returnFalse,n.onselectstart=e.returnFalse,this._setElementStyle(s),this._setBoundary(),a=this.getMovable(),a&&(a.onselectstart=e.returnFalse,this._movableInitialGeometry=t.getGeometry(a),this._movableGeometry=r.copy(this._movableInitialGeometry),this._baseMovableOffset={left:this._movableGeometry.x-a.offsetLeft,top:this._movableGeometry.y-a.offsetTop,height:this._movableGeometry.height-a.offsetHeight,width:this._movableGeometry.width-a.offsetWidth},this.$raiseEvent("beforeresize"))},move:function(e){var t=this.getMovable();if(t&&t.style){var i,a,s=this._vertical?0:e.clientX-this.posX,n=this._horizontal?0:e.clientY-this.posY,o=r.copy(this._movableGeometry);o=this._resizeWitHandlers(o,this.cursor,s,n);var l=/sw-resize|nw-resize|w-resize/.test(this.cursor),c=/nw-resize|ne-resize|n-resize/.test(this.cursor),u=o.width<this.minWidth,h=o.height<this.minHeight;u&&(o.width=this.minWidth),h&&(o.height=this.minHeight),i=this._movableGeometry.x+this._movableGeometry.width,a=this._movableGeometry.y+this._movableGeometry.height,u&&l&&(o.x=i-this.minWidth),h&&c&&(o.y=a-this.minHeight),t.style.cursor=this.cursor,t.style.top=o.y-this._baseMovableOffset.top+"px",t.style.left=o.x-this._baseMovableOffset.left+"px",t.style.height=o.height-this._baseMovableOffset.height+"px",t.style.width=o.width-this._baseMovableOffset.width+"px",this._movableGeometry=o,this.$raiseEvent("resize")}},end:function(){var t=this.getElement();t.onselectstart=e.returnTrue,this.proxy&&this.proxy.overlay&&(t.style.top=this._elementInitialPosition.top+this._movableGeometry.y-this._movableInitialGeometry.y+"px",t.style.left=this._elementInitialPosition.left+this._movableGeometry.x-this._movableInitialGeometry.x+"px",t.style.height=this._elementInitialPosition.height+this._movableGeometry.height-this._movableInitialGeometry.height+"px",t.style.width=this._elementInitialPosition.width+this._movableGeometry.width-this._movableInitialGeometry.width+"px",this.proxy.$dispose(),this.proxy=null),this.$raiseEvent("resizeend")},_resizeWitHandlers:function(e,t,a,s){var e=r.copy(e),n=i.trim;t=n(t);var o=e.width>=this.minWidth?a:0,l=e.height>=this.minHeight?s:0;switch(t){case"n-resize":e.y+=l,e.height-=l,e=this._fitResizeBoundary(e),this.posY+=e.y-this._movableGeometry.y;break;case"ne-resize":e.y+=l,e.height-=l,e.width+=o,e=this._fitResizeBoundary(e),this.posX+=o,this.posY+=e.y-this._movableGeometry.y;break;case"nw-resize":e.x+=o,e.y+=l,e.height-=l,e.width-=o,e=this._fitResizeBoundary(e),this.posX+=e.x-this._movableGeometry.x,this.posY+=e.y-this._movableGeometry.y;break;case"s-resize":e.height+=l,e=this._fitResizeBoundary(e),this.posY+=l;break;case"se-resize":e.height+=l,e.width+=o,e=this._fitResizeBoundary(e),this.posY+=l,this.posX+=o;break;case"sw-resize":e.x+=o,e.height+=l,e.width-=o,e=this._fitResizeBoundary(e),this.posY+=l,this.posX+=e.x-this._movableGeometry.x;break;case"e-resize":e.width+=o,e=this._fitResizeBoundary(e),this.posX+=o;break;case"w-resize":e.x+=o,e.width-=o,e=this._fitResizeBoundary(e),this.posX+=e.x-this._movableGeometry.x}return e},_fitResizeBoundary:function(e){var i=t,r=this._boundary?i.fitInside(e,this._boundary):{top:e.y,left:e.x};return e.x=r.left,e.y=r.top,e},_setElementStyle:function(e){var t=e.style,i={left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight,width:e.offsetWidth};this._elementInitialPosition=i,t.position="absolute",t.left=i.left+"px",t.top=i.top+"px",t.height=i.height+"px",t.width=i.width+"px"}}});